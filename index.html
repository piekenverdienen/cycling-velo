<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vivelevelo Pro Gepolariseerd Training - Wetenschappelijk Onderbouwd</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .vv-training-tool {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .vv-header {
            background: linear-gradient(135deg, #FF6B35 0%, #F72585 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .vv-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: slide 20s linear infinite;
        }
        
        @keyframes slide {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .vv-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .vv-header p {
            font-size: 1.1rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }
        
        .vv-zwift-badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
        }
        
        .vv-zwift-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .vv-content {
            padding: 40px;
        }
        
        .vv-intro-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #90caf9;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .vv-intro-box h3 {
            color: #1976d2;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .vv-science-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #fff3e0 100%);
            border: 2px solid #4caf50;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .vv-science-box h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .vv-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .vv-form-group {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .vv-form-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .vv-form-group.error {
            border-color: #dc3545;
            background: #fff5f5;
        }
        
        .vv-form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3436;
            font-size: 0.95rem;
        }
        
        .vv-form-group input,
        .vv-form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .vv-form-group input:focus,
        .vv-form-group select:focus {
            outline: none;
            border-color: #FF6B35;
        }
        
        .vv-form-group input.error {
            border-color: #dc3545;
        }
        
        .vv-form-group small {
            display: block;
            margin-top: 8px;
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .vv-form-group .error-msg {
            color: #dc3545;
            font-size: 0.85rem;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .vv-form-group .success-msg {
            color: #28a745;
            font-size: 0.85rem;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .vv-btn {
            background: linear-gradient(135deg, #FF6B35 0%, #F72585 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .vv-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
        }
        
        .vv-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .vv-zones-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .vv-zones-container h3 {
            text-align: center;
            margin-bottom: 25px;
            color: #2d3436;
        }
        
        .vv-zone-box {
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .vv-zone-box:hover {
            transform: translateX(5px);
        }
        
        .vv-zone-1 {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        
        .vv-zone-grey {
            background: #fff3e0;
            border-color: #ff9800;
            position: relative;
        }
        
        .vv-zone-grey::after {
            content: '‚ö†Ô∏è GRIJZE ZONE - VERMIJD!';
            position: absolute;
            top: 5px;
            right: 10px;
            background: #ff5722;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .vv-zone-threshold {
            background: #f3e5f5;
            border-color: #9c27b0;
        }
        
        .vv-zone-3 {
            background: #ffebee;
            border-color: #f44336;
        }
        
        .vv-week-container {
            margin: 30px 0;
        }
        
        .vv-week-header {
            background: linear-gradient(135deg, #5c6bc0 0%, #3949ab 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .vv-week-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }
        
        .vv-week-badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .vv-week-content {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 0 0 10px 10px;
            border: 1px solid #e9ecef;
            border-top: none;
        }
        
        .vv-workout {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }
        
        .vv-workout:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .vv-workout-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .vv-workout-day {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3436;
        }
        
        .vv-workout-emoji {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .vv-workout-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .vv-workout-duration {
            background: #FF6B35;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .vv-erg-mode {
            background: #7c3aed;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .vv-zone-tag {
            background: #4caf50;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .vv-zone-tag.zone3 {
            background: #f44336;
        }
        
        .vv-zone-tag.threshold {
            background: #9c27b0;
        }
        
        .vv-tss-tag {
            background: #607d8b;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .vv-workout-description {
            color: #555;
            margin-bottom: 10px;
            font-size: 1.05rem;
        }
        
        .vv-workout-structure {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .vv-workout-structure h5 {
            color: #1565c0;
            margin-bottom: 10px;
        }
        
        .vv-workout-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .vv-workout-details ul {
            list-style: none;
            margin: 0;
        }
        
        .vv-workout-details li {
            padding: 5px 0;
            color: #666;
            font-size: 0.95rem;
        }
        
        .vv-workout-details li strong {
            color: #333;
        }
        
        .vv-rest-day {
            background: #f1f3f5;
            opacity: 0.7;
            border: 1px dashed #dee2e6;
        }
        
        .vv-week-summary {
            background: white;
            border: 2px solid #e9ecef;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .vv-week-summary h4 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .vv-week-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        
        .vv-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .vv-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #FF6B35;
        }
        
        .vv-stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .vv-polarized-summary {
            background: linear-gradient(135deg, #e8f5e9 0%, #ffebee 100%);
            border: 2px solid #4caf50;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .vv-polarized-summary h5 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .vv-polarized-bar {
            display: flex;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .vv-zone1-bar {
            background: #4caf50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .vv-zone3-bar {
            background: #f44336;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .vv-export-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
        }
        
        .vv-export-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .vv-export-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .vv-export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .vv-export-btn.zwift {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8f65 100%);
        }
        
        .vv-export-btn.strava {
            background: linear-gradient(135deg, #fc4c02 0%, #ff6b35 100%);
        }
        
        .vv-export-btn.print {
            background: linear-gradient(135deg, #607d8b 0%, #78909c 100%);
        }
        
        .vv-tips {
            background: linear-gradient(135deg, #e3f2fd 0%, #e8eaf6 100%);
            border: 1px solid #90caf9;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
        }
        
        .vv-tips h3 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .vv-tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .vv-tip-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .vv-tip-card h4 {
            color: #1565c0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .vv-tip-card ul {
            list-style: none;
            margin: 0;
        }
        
        .vv-tip-card li {
            padding: 5px 0;
            font-size: 0.95rem;
            color: #555;
        }
        
        .vv-footer {
            background: #2d3436;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .vv-footer p {
            margin: 5px 0;
            opacity: 0.8;
        }
        
        .vv-footer a {
            color: #FF6B35;
            text-decoration: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        @media print {
            .vv-header::before,
            .vv-export-section,
            .vv-btn,
            .vv-footer {
                display: none !important;
            }
            
            .vv-workout {
                break-inside: avoid;
            }
        }
        
        .vv-loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .vv-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #FF6B35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .vv-progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .vv-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #F72585);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="vv-training-tool">
        <div class="vv-header">
            <h1>üö¥ Vivelevelo PRO Gepolariseerd</h1>
            <p>Wetenschappelijk Onderbouwd 6-Weken Schema - Gebruiker-Getest & Coach-Approved</p>
            <div class="vv-zwift-badges">
                <span class="vv-zwift-badge">‚úì Zwift Compatible</span>
                <span class="vv-zwift-badge">‚úì ERG Mode Ready</span>
                <span class="vv-zwift-badge">‚úì 80/20 Gepolariseerd</span>
                <span class="vv-zwift-badge">‚úì Coach Approved</span>
                <span class="vv-zwift-badge">‚úì TSS Berekend</span>
            </div>
        </div>
        
        <div class="vv-content">
            <div id="vvInputForm">
                <div class="vv-intro-box">
                    <h3>üß¨ Waarom Wetenschappelijk Gepolariseerd Trainen?</h3>
                    <p>Profwielrenners trainen <strong>‚âà80% in Zone 1</strong> (aerobe basis, praten mogelijk) 
                    en <strong>‚âà20% in Zone 3+</strong> (VO‚ÇÇmax, anaeroob, neuromuscular). De "grijze zone" 
                    (70-85% FTP) wordt grotendeels vermeden.</p>
                </div>
                
                <div class="vv-science-box">
                    <h4>üî¨ Wetenschappelijke Zone Definities (Coggan/Seiler)</h4>
                    <p><strong>Zone 1:</strong> ‚â§70% FTP (aerobe basis) | <strong>Grijze Zone:</strong> 70-85% FTP (vermijden!) | 
                    <strong>Threshold:</strong> 85-105% FTP (beperkt gebruik) | <strong>Zone 3:</strong> >105% FTP (VO‚ÇÇmax/anaeroob)</p>
                </div>
                
                <div class="vv-progress-bar">
                    <div class="vv-progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="vv-form-grid">
                    <div class="vv-form-group" id="ftpGroup">
                        <label>üî• FTP (Functional Threshold Power)</label>
                        <input type="number" id="vvFtp" value="250" min="120" max="450" 
                               onchange="validateInput('ftp'); saveSessionData();" onkeyup="validateInput('ftp'); saveSessionData();">
                        <small>Je 1-uur drempelvermogen (120-450W realistisch)</small>
                        <div class="error-msg" id="ftpError"></div>
                        <div class="success-msg" id="ftpSuccess"></div>
                    </div>
                    
                    <div class="vv-form-group" id="weightGroup">
                        <label>‚öñÔ∏è Gewicht (kg)</label>
                        <input type="number" id="vvWeight" value="75" min="50" max="110" step="0.1"
                               onchange="validateInput('weight'); saveSessionData();" onkeyup="validateInput('weight'); saveSessionData();">
                        <small>Voor W/kg berekening (50-110kg realistisch)</small>
                        <div class="error-msg" id="weightError"></div>
                        <div class="success-msg" id="weightSuccess"></div>
                    </div>
                    
                    <div class="vv-form-group">
                        <label>üìÖ Trainingsfrequentie</label>
                        <select id="vvDays" onchange="updateProgress(); saveSessionData();">
                            <option value="3">3x per week (Beginner - 3:1 ratio)</option>
                            <option value="4" selected>4x per week (Gemiddeld - 4:1 ratio)</option>
                            <option value="5">5x per week (Gevorderd - 5:1 ratio)</option>
                            <option value="6">6x per week (Expert - 6:1 ratio)</option>
                        </select>
                        <small>Kies realistisch - kwaliteit boven kwantiteit!</small>
                    </div>
                    
                    <div class="vv-form-group">
                        <label>üéØ Trainingsdoel</label>
                        <select id="vvGoal" onchange="updateProgress(); saveSessionData();">
                            <option value="ftp">FTP Verhoging (Threshold Power)</option>
                            <option value="climbing">Klimvermogen & W/kg Optimalisatie</option>
                            <option value="racing">Zwift Racing & Criterium Prep</option>
                            <option value="endurance">Lange Ritten & Fat Adaptation</option>
                        </select>
                        <small>Alle doelen gebruiken gepolariseerde methodiek</small>
                    </div>
                    
                    <div class="vv-form-group">
                        <label>üö≤ Trainer Setup</label>
                        <select id="vvTrainer" onchange="updateProgress(); saveSessionData();">
                            <option value="smart">Smart Trainer (ERG Mode + Power)</option>
                            <option value="basic">Basic Trainer (Manual + HR/RPE)</option>
                        </select>
                        <small>Smart trainers maken interval training nauwkeuriger</small>
                    </div>
                    
                    <div class="vv-form-group">
                        <label>üèÜ Ervaringsniveau</label>
                        <select id="vvLevel" onchange="updateProgress(); saveSessionData();">
                            <option value="beginner">Beginner (0-1 jaar training)</option>
                            <option value="intermediate" selected>Gemiddeld (1-3 jaar)</option>
                            <option value="advanced">Gevorderd (3+ jaar)</option>
                        </select>
                        <small>Bepaalt intensiteit en volume progressie</small>
                    </div>
                </div>
                
                <button class="vv-btn" id="generateBtn" onclick="generateVVPlan()" disabled>
                    üöÄ Genereer Mijn Wetenschappelijk Schema
                </button>
            </div>
            
            <div id="vvLoading" class="vv-loading">
                <div class="vv-spinner"></div>
                <p>Je persoonlijke schema wordt gegenereerd...<br>
                <small>Berekeningen: zones, TSS, periodisering, herstel</small></p>
            </div>
            
            <div id="vvResults" class="hidden">
                <div id="vvOutput"></div>
                
                <div class="vv-export-section">
                    <h3>üì§ Exporteer je gepolariseerde schema</h3>
                    <div class="vv-export-buttons">
                        <button class="vv-export-btn zwift" onclick="exportZwift()">
                            <span>üü†</span> Export naar Zwift
                        </button>
                        <button class="vv-export-btn strava" onclick="shareStrava()">
                            <span>üü†</span> Deel op Strava
                        </button>
                        <button class="vv-export-btn print" onclick="printPlan()">
                            <span>üñ®Ô∏è</span> Print Schema
                        </button>
                        <button class="vv-export-btn" onclick="emailPlan()">
                            <span>üìß</span> Email naar mezelf
                        </button>
                    </div>
                    
                    <h4 style="margin-top: 30px; color: #495057;">üíæ Instellingen Opslaan</h4>
                    <div class="vv-export-buttons">
                        <button class="vv-export-btn" onclick="exportSettings()" style="background: #28a745;">
                            <span>üíæ</span> Export Instellingen
                        </button>
                        <button class="vv-export-btn" onclick="importSettings()" style="background: #17a2b8;">
                            <span>üì•</span> Import Instellingen
                        </button>
                    </div>
                    <p style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 10px;">
                        Sla je FTP, gewicht en voorkeuren op om later weer te gebruiken
                    </p>
                </div>
                
                <div class="vv-tips">
                    <h3>üèÜ Pro Tips voor Gepolariseerd Training Succes</h3>
                    <div class="vv-tips-grid">
                        <div class="vv-tip-card">
                            <h4>üü¢ Zone 1 Perfectie</h4>
                            <ul>
                                <li>‚Ä¢ <strong>‚â§70% FTP:</strong> Praten altijd mogelijk</li>
                                <li>‚Ä¢ Netflix perfect, groepsritten ideaal</li>
                                <li>‚Ä¢ 1 ventilator, 500ml/uur drinken</li>
                                <li>‚Ä¢ 85-95rpm cadans, aerobe basis</li>
                                <li>‚Ä¢ Fat burning, herstel focus</li>
                            </ul>
                        </div>
                        
                        <div class="vv-tip-card">
                            <h4>üî¥ Zone 3+ Intensiteit</h4>
                            <ul>
                                <li>‚Ä¢ <strong>>105% FTP:</strong> Praten onmogelijk</li>
                                <li>‚Ä¢ Alle ventilatoren maximaal!</li>
                                <li>‚Ä¢ 1L+ per uur, sport drink</li>
                                <li>‚Ä¢ ERG mode voor power controle</li>
                                <li>‚Ä¢ Complete focus, maximale inspanning</li>
                            </ul>
                        </div>
                        
                        <div class="vv-tip-card">
                            <h4>‚ö†Ô∏è Grijze Zone Vermijden</h4>
                            <ul>
                                <li>‚Ä¢ <strong>70-85% FTP:</strong> Te zwaar voor herstel</li>
                                <li>‚Ä¢ Te licht voor adaptatie</li>
                                <li>‚Ä¢ Geen sweetspot, tempo, steady state</li>
                                <li>‚Ä¢ Veroorzaakt overtraining</li>
                                <li>‚Ä¢ Vermindert training kwaliteit</li>
                            </ul>
                        </div>
                        
                        <div class="vv-tip-card">
                            <h4>üéØ RPE & Hartslag Zones</h4>
                            <ul>
                                <li>‚Ä¢ <strong>Zone 1:</strong> RPE 3-5/10, praten makkelijk</li>
                                <li>‚Ä¢ <strong>Grijze Zone:</strong> RPE 6-7/10, gesprek moeilijk</li>
                                <li>‚Ä¢ <strong>Threshold:</strong> RPE 8/10, enkele woorden</li>
                                <li>‚Ä¢ <strong>Zone 3:</strong> RPE 9-10/10, geen praten</li>
                                <li>‚Ä¢ Hartslag: Zone 1 = 60-70% HRmax</li>
                            </ul>
                        </div>
                        
                        <div class="vv-tip-card">
                            <h4>üß™ Wetenschappelijke Basis</h4>
                            <ul>
                                <li>‚Ä¢ Seiler: 80/20 verdeling optimaal</li>
                                <li>‚Ä¢ Coggan: zone definities accuraat</li>
                                <li>‚Ä¢ 3:1 loading pattern bewezen</li>
                                <li>‚Ä¢ TSS berekeningen realistisch</li>
                                <li>‚Ä¢ Periodisering voor adaptatie</li>
                            </ul>
                        </div>
                        
                        <div class="vv-tip-card">
                            <h4>üçé Voeding & Recovery</h4>
                            <ul>
                                <li>‚Ä¢ Zone 1: Water voldoende, 30g KH/uur</li>
                                <li>‚Ä¢ Zone 3: Isotone drank, 60g+ KH/uur</li>
                                <li>‚Ä¢ Post-workout: Eiwit binnen 30min</li>
                                <li>‚Ä¢ Sleep: 7-9u voor optimaal herstel</li>
                                <li>‚Ä¢ HRV monitoring aanbevolen</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <button class="vv-btn" onclick="resetVVForm()" style="margin-top: 40px;">
                    üîÑ Maak een Nieuw Schema
                </button>
            </div>
        </div>
        
        <div class="vv-footer">
            <p>üö¥ Powered by <a href="https://vivelevelo.nl">Vivelevelo.nl</a> - Wetenschappelijk Gepolariseerd Trainen</p>
            <p>Gebaseerd op onderzoek van Seiler, Coggan, en internationale studies naar 80/20 training</p>
        </div>
    </div>
    
    <script>
    // Global variables including session storage
    var globalFtp, globalWeight, globalDays, globalGoal, globalTrainer, globalLevel;
    var isFormValid = false;
    var sessionData = {}; // In-memory storage for session
    
    // Input validation functions
    function validateInput(type) {
        const ftpInput = document.getElementById('vvFtp');
        const weightInput = document.getElementById('vvWeight');
        const ftpGroup = document.getElementById('ftpGroup');
        const weightGroup = document.getElementById('weightGroup');
        
        let isValid = true;
        
        if (type === 'ftp' || type === 'all') {
            const ftp = parseInt(ftpInput.value);
            const ftpError = document.getElementById('ftpError');
            const ftpSuccess = document.getElementById('ftpSuccess');
            
            ftpError.textContent = '';
            ftpSuccess.textContent = '';
            ftpGroup.classList.remove('error');
            ftpInput.classList.remove('error');
            
            if (!ftp || ftp < 120) {
                ftpError.textContent = 'FTP te laag - minimum 120W voor effectieve training';
                ftpGroup.classList.add('error');
                ftpInput.classList.add('error');
                isValid = false;
            } else if (ftp > 450) {
                ftpError.textContent = 'FTP te hoog - maximum 450W voor amateur gebruik';
                ftpGroup.classList.add('error');
                ftpInput.classList.add('error');
                isValid = false;
            } else {
                ftpSuccess.textContent = `‚úì FTP ${ftp}W is realistisch voor amateur niveau`;
            }
        }
        
        if (type === 'weight' || type === 'all') {
            const weight = parseFloat(weightInput.value);
            const weightError = document.getElementById('weightError');
            const weightSuccess = document.getElementById('weightSuccess');
            
            weightError.textContent = '';
            weightSuccess.textContent = '';
            weightGroup.classList.remove('error');
            weightInput.classList.remove('error');
            
            if (!weight || weight < 50) {
                weightError.textContent = 'Gewicht te laag - minimum 50kg';
                weightGroup.classList.add('error');
                weightInput.classList.add('error');
                isValid = false;
            } else if (weight > 110) {
                weightError.textContent = 'Gewicht te hoog - maximum 110kg';
                weightGroup.classList.add('error');
                weightInput.classList.add('error');
                isValid = false;
            } else {
                weightSuccess.textContent = `‚úì Gewicht ${weight}kg is realistisch`;
            }
        }
        
        // Cross-validation: W/kg check
        if (type === 'all' || (ftpInput.value && weightInput.value)) {
            const ftp = parseInt(ftpInput.value);
            const weight = parseFloat(weightInput.value);
            const wkg = ftp / weight;
            
            if (ftp && weight && (wkg < 1.5 || wkg > 6.5)) {
                const errorMsg = wkg < 1.5 ? 'W/kg te laag - check FTP en gewicht' : 'W/kg te hoog - check FTP en gewicht';
                document.getElementById('ftpError').textContent = errorMsg;
                ftpGroup.classList.add('error');
                isValid = false;
            } else if (ftp && weight) {
                const category = wkg < 2.5 ? 'Beginner' : wkg < 3.5 ? 'Gemiddeld' : wkg < 4.5 ? 'Goed' : 'Excellent';
                document.getElementById('weightSuccess').textContent = `‚úì W/kg: ${wkg.toFixed(1)} (${category})`;
            }
        }
        
        updateFormValidation();
        updateProgress();
    }
    
    function saveSessionData() {
        sessionData = {
            ftp: document.getElementById('vvFtp').value,
            weight: document.getElementById('vvWeight').value,
            days: document.getElementById('vvDays').value,
            goal: document.getElementById('vvGoal').value,
            trainer: document.getElementById('vvTrainer').value,
            level: document.getElementById('vvLevel').value,
            timestamp: new Date().toISOString()
        };
        console.log('Session data saved:', sessionData);
    }
    
    function loadSessionData() {
        if (Object.keys(sessionData).length > 0) {
            document.getElementById('vvFtp').value = sessionData.ftp || '250';
            document.getElementById('vvWeight').value = sessionData.weight || '75';
            document.getElementById('vvDays').value = sessionData.days || '4';
            document.getElementById('vvGoal').value = sessionData.goal || 'ftp';
            document.getElementById('vvTrainer').value = sessionData.trainer || 'smart';
            document.getElementById('vvLevel').value = sessionData.level || 'intermediate';
            
            validateInput('all');
            updateProgress();
            console.log('Session data loaded');
        }
    }
    
    function exportSettings() {
        saveSessionData();
        const exportData = JSON.stringify(sessionData, null, 2);
        
        // Create downloadable text
        const blob = new Blob([exportData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'vivelevelo-settings.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        // Also show in alert for copy/paste
        alert('üìã Je instellingen:\n\n' + exportData + '\n\nSla deze tekst op om later te importeren!');
    }
    
    function importSettings() {
        const importData = prompt('üì• Plak je opgeslagen instellingen hier:\n\n(JSON formaat van export)');
        
        if (importData) {
            try {
                const parsed = JSON.parse(importData);
                sessionData = parsed;
                loadSessionData();
                alert('‚úÖ Instellingen succesvol ge√Ømporteerd!');
            } catch (error) {
                alert('‚ùå Ongeldige instellingen. Controleer het JSON formaat.');
            }
        }
    }

    function updateFormValidation() {
        const ftp = parseInt(document.getElementById('vvFtp').value);
        const weight = parseFloat(document.getElementById('vvWeight').value);
        const generateBtn = document.getElementById('generateBtn');
        
        isFormValid = ftp >= 120 && ftp <= 450 && weight >= 50 && weight <= 110;
        
        generateBtn.disabled = !isFormValid;
        if (isFormValid) {
            generateBtn.textContent = 'üöÄ Genereer Mijn Wetenschappelijk Schema';
        } else {
            generateBtn.textContent = '‚ö†Ô∏è Corrigeer Invoer Eerst';
        }
    }
    
    function updateProgress() {
        const ftp = document.getElementById('vvFtp').value;
        const weight = document.getElementById('vvWeight').value;
        const days = document.getElementById('vvDays').value;
        const goal = document.getElementById('vvGoal').value;
        const trainer = document.getElementById('vvTrainer').value;
        const level = document.getElementById('vvLevel').value;
        
        let progress = 0;
        if (ftp && parseInt(ftp) >= 120 && parseInt(ftp) <= 450) progress += 20;
        if (weight && parseFloat(weight) >= 50 && parseFloat(weight) <= 110) progress += 20;
        if (days) progress += 20;
        if (goal) progress += 20;
        if (trainer) progress += 10;
        if (level) progress += 10;
        
        document.querySelector('.vv-progress-fill').style.width = progress + '%';
    }
    
    function generateVVPlan() {
        if (!isFormValid) {
            alert('Corrigeer eerst de invoerfouten voordat je het schema genereert!');
            return;
        }
        
        // Get values
        globalFtp = parseInt(document.getElementById('vvFtp').value);
        globalWeight = parseFloat(document.getElementById('vvWeight').value);
        globalDays = parseInt(document.getElementById('vvDays').value);
        globalGoal = document.getElementById('vvGoal').value;
        globalTrainer = document.getElementById('vvTrainer').value;
        globalLevel = document.getElementById('vvLevel').value;
        
        // Show loading
        document.getElementById('vvInputForm').style.display = 'none';
        document.getElementById('vvLoading').style.display = 'block';
        
        // Simulate realistic loading time for calculations
        setTimeout(function() {
            document.getElementById('vvLoading').style.display = 'none';
            document.getElementById('vvResults').classList.remove('hidden');
            createCompleteOutput();
        }, 2000);
    }
    
    function createCompleteOutput() {
        var wkg = (globalFtp / globalWeight).toFixed(1);
        
        // Wetenschappelijke zone berekeningen
        var zone1Upper = Math.round(globalFtp * 0.70);  // 70% FTP max voor Zone 1
        var zone1Recovery = Math.round(globalFtp * 0.55); // 55% FTP voor herstel
        var zone1Endurance = Math.round(globalFtp * 0.65); // 65% FTP voor duur
        var greyZoneLower = Math.round(globalFtp * 0.71); // 71% start grijze zone
        var greyZoneUpper = Math.round(globalFtp * 0.84); // 84% eind grijze zone
        var thresholdLower = Math.round(globalFtp * 0.85); // 85% threshold begin
        var thresholdUpper = Math.round(globalFtp * 1.05); // 105% threshold eind
        var zone3Lower = Math.round(globalFtp * 1.06); // 106% VO2max begin
        
        var html = '';
        
        // Training zones - wetenschappelijk correct
        html += '<div class="vv-zones-container">';
        html += '<h3>üéØ Jouw Wetenschappelijke Trainingszones</h3>';
        html += '<p style="text-align: center; margin-bottom: 20px; font-size: 1.1rem;">';
        html += '<strong>FTP: ' + globalFtp + 'W (' + wkg + ' W/kg)</strong></p>';
        
        html += '<div class="vv-zone-box vv-zone-1">';
        html += '<div>';
        html += '<strong>Zone 1 - Aerobe Basis (‚âà80% training)</strong><br>';
        html += 'Herstel: ' + zone1Recovery + '-' + Math.round(globalFtp * 0.60) + 'W | ';
        html += 'Duur: ' + zone1Endurance + '-' + zone1Upper + 'W';
        html += '</div>';
        html += '<div>';
        html += '<strong>‚â§ ' + zone1Upper + 'W</strong><br>';
        html += '<small>Praten mogelijk</small>';
        html += '</div>';
        html += '</div>';
        
        html += '<div class="vv-zone-box vv-zone-grey">';
        html += '<div>';
        html += '<strong>Grijze Zone - GROTENDEELS VERMIJDEN</strong><br>';
        html += 'Te zwaar voor herstel, te licht voor adaptatie';
        html += '</div>';
        html += '<div>';
        html += '<strong>' + greyZoneLower + '-' + greyZoneUpper + 'W</strong><br>';
        html += '<small>70-84% FTP</small>';
        html += '</div>';
        html += '</div>';
        
        html += '<div class="vv-zone-box vv-zone-threshold">';
        html += '<div>';
        html += '<strong>Threshold Zone - BEPERKT GEBRUIK</strong><br>';
        html += 'FTP tests, threshold intervals (max 10% training)';
        html += '</div>';
        html += '<div>';
        html += '<strong>' + thresholdLower + '-' + thresholdUpper + 'W</strong><br>';
        html += '<small>85-105% FTP</small>';
        html += '</div>';
        html += '</div>';
        
        html += '<div class="vv-zone-box vv-zone-3">';
        html += '<div>';
        html += '<strong>Zone 3+ - Hoge Intensiteit (‚âà20% training)</strong><br>';
        html += 'VO‚ÇÇmax, Anaerobe power, Neuromuscular';
        html += '</div>';
        html += '<div>';
        html += '<strong>> ' + zone3Lower + 'W</strong><br>';
        html += '<small>Praten onmogelijk</small>';
        html += '</div>';
        html += '</div>';
        html += '</div>';
        
        // 6-week program with improved periodization
        html += '<h2 style="text-align: center; margin: 40px 0;">üìÖ Jouw 6-Weken Wetenschappelijk Schema</h2>';
        html += '<p style="text-align: center; margin-bottom: 30px; color: #666; font-size: 1.05rem;">3:1 Loading Pattern - Week 1-3 Opbouw, Week 4 Recovery, Week 5-6 Peak & Test</p>';
        
        // Generate all 6 weeks with improved structure
        for (var week = 1; week <= 6; week++) {
            html += generateWeek(week);
        }
        
        document.getElementById('vvOutput').innerHTML = html;
    }
    
    function generateWeek(week) {
        var html = '<div class="vv-week-container">';
        
        // Week header with improved theming
        var weekThemes = {
            1: { name: 'Adaptatie Fase', color: '#4caf50', focus: 'Aerobe basis + introductie Z3' },
            2: { name: 'Volume Opbouw', color: '#2196f3', focus: 'Z1 uitbreiding + Z3 progressie' },
            3: { name: 'Intensiteit Peak', color: '#ff9800', focus: 'Maximum Z3 belasting' },
            4: { name: 'Recovery Week', color: '#9c27b0', focus: 'Actief herstel + adaptatie' },
            5: { name: 'Peak Performance', color: '#f44336', focus: 'Race sharpness + power' },
            6: { name: 'Test & Validate', color: '#795548', focus: 'FTP test + prestatie check' }
        };
        
        var theme = weekThemes[week];
        html += '<div class="vv-week-header" style="background: ' + theme.color + ';">';
        html += '<h3>Week ' + week + ' - ' + theme.name + '</h3>';
        html += '<span class="vv-week-badge">' + theme.focus + '</span>';
        html += '</div>';
        
        html += '<div class="vv-week-content">';
        
        // Generate workouts for the week using improved algorithm
        var weekPlan = generateWeekWorkouts(week);
        var weekStats = { 
            workouts: 0, 
            totalMinutes: 0, 
            zone1Minutes: 0, 
            zone3Minutes: 0,
            thresholdMinutes: 0,
            tss: 0 
        };
        
        var dayNames = ['Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrijdag', 'Zaterdag', 'Zondag'];
        
        dayNames.forEach(function(day, index) {
            var workout = weekPlan[day];
            if (workout) {
                html += createWorkoutCard(day, workout);
                weekStats.workouts++;
                weekStats.totalMinutes += workout.duration;
                weekStats.tss += workout.tss || 0;
                
                if (workout.zone === 1) {
                    weekStats.zone1Minutes += workout.duration;
                } else if (workout.zone === 3) {
                    weekStats.zone3Minutes += workout.duration;
                } else if (workout.zone === 'threshold') {
                    weekStats.thresholdMinutes += workout.duration;
                }
            } else {
                html += createRestDay(day);
            }
        });
        
        // Improved polarized summary with visual bar
        var zone1Percent = weekStats.totalMinutes > 0 ? Math.round((weekStats.zone1Minutes / weekStats.totalMinutes) * 100) : 0;
        var zone3Percent = weekStats.totalMinutes > 0 ? Math.round((weekStats.zone3Minutes / weekStats.totalMinutes) * 100) : 0;
        var thresholdPercent = weekStats.totalMinutes > 0 ? Math.round((weekStats.thresholdMinutes / weekStats.totalMinutes) * 100) : 0;
        
        html += '<div class="vv-polarized-summary">';
        html += '<h5>üìä Gepolariseerde Verdeling Week ' + week + '</h5>';
        html += '<div class="vv-polarized-bar">';
        if (zone1Percent > 0) {
            html += '<div class="vv-zone1-bar" style="width: ' + zone1Percent + '%;">Z1: ' + zone1Percent + '%</div>';
        }
        if (zone3Percent > 0) {
            html += '<div class="vv-zone3-bar" style="width: ' + zone3Percent + '%;">Z3: ' + zone3Percent + '%</div>';
        }
        html += '</div>';
        html += '<p><strong>Zone 1:</strong> ' + weekStats.zone1Minutes + ' min (' + zone1Percent + '%) | ';
        html += '<strong>Zone 3:</strong> ' + weekStats.zone3Minutes + ' min (' + zone3Percent + '%)';
        if (thresholdPercent > 0) {
            html += ' | <strong>Threshold:</strong> ' + weekStats.thresholdMinutes + ' min (' + thresholdPercent + '%)';
        }
        html += '</p>';
        html += '</div>';
        
        // Week summary with accurate metrics
        html += '<div class="vv-week-summary">';
        html += '<h4>Week ' + week + ' Samenvatting</h4>';
        html += '<div class="vv-week-stats">';
        html += '<div class="vv-stat"><div class="vv-stat-value">' + weekStats.workouts + '</div><div class="vv-stat-label">Trainingen</div></div>';
        html += '<div class="vv-stat"><div class="vv-stat-value">' + Math.round(weekStats.totalMinutes / 60 * 10) / 10 + 'u</div><div class="vv-stat-label">Totale tijd</div></div>';
        html += '<div class="vv-stat"><div class="vv-stat-value">' + zone1Percent + '%</div><div class="vv-stat-label">Zone 1</div></div>';
        html += '<div class="vv-stat"><div class="vv-stat-value">' + zone3Percent + '%</div><div class="vv-stat-label">Zone 3</div></div>';
        html += '<div class="vv-stat"><div class="vv-stat-value">' + weekStats.tss + '</div><div class="vv-stat-label">TSS</div></div>';
        html += '</div>';
        html += '</div>';
        
        html += '</div></div>';
        
        return html;
    }
    
    function generateWeekWorkouts(week) {
        var workouts = {};
        var trainingDays = getTrainingDays();
        
        // Use improved algorithm based on goal and week
        if (globalGoal === 'ftp') {
            workouts = generateScientificFTPWeek(week, trainingDays);
        } else if (globalGoal === 'climbing') {
            workouts = generateScientificClimbingWeek(week, trainingDays);
        } else if (globalGoal === 'racing') {
            workouts = generateScientificRacingWeek(week, trainingDays);
        } else {
            workouts = generateScientificEnduranceWeek(week, trainingDays);
        }
        
        return workouts;
    }
    
    // IMPROVED FTP TRAINING (more scientific approach)
    function generateScientificFTPWeek(week, days) {
        var workouts = {};
        if (!days || days.length === 0) return workouts;
        var dayCount = Math.min(days.length, globalDays);
        
        // ECHT GEPOLARISEERD: 80% Zone 1, 20% hoge intensiteit
        if (week === 1) {
            // Adaptation week - 1 moderate session
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(1, 'intro');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 2) {
            // Volume build - 1 hard session only
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(2, 'standard');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 3) {
            // Peak loading - 1 hard + 1 threshold (max)
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(3, 'peak');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = (dayCount >= 6 && globalLevel !== 'beginner') ? getThresholdWorkout(3, 'short') : getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 4) {
            // Recovery week - alleen Zone 1
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getZone1Workout('recovery');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('endurance');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('recovery');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('medium');
        } else if (week === 5) {
            // Peak performance - 1 quality session
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(5, 'sharpener');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 6) {
            // Test week with minimal intensity
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(6, 'opener');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getFTPTestWorkout();
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('recovery');
        }
        
        return workouts;
    }
    
    // Similar improved functions for other goals...
    function generateScientificClimbingWeek(week, days) {
        var workouts = {};
        if (!days || days.length === 0) return workouts;
        var dayCount = Math.min(days.length, globalDays);
        
        // Climbing-specific met MEER Zone 1 focus
        if (week === 1) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getClimbingVO2MaxWorkout(1);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1ClimbingWorkout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1ClimbingWorkout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1ClimbingWorkout('recovery');
        } else if (week === 2) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getClimbingVO2MaxWorkout(2);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1ClimbingWorkout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1ClimbingWorkout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1ClimbingWorkout('recovery');
        } else if (week === 3) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getClimbingVO2MaxWorkout(3);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1ClimbingWorkout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = (dayCount >= 6 && globalLevel !== 'beginner') ? getClimbingThresholdWorkout(3) : getZone1ClimbingWorkout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1ClimbingWorkout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1ClimbingWorkout('recovery');
        } else if (week === 4) {
            // Recovery week
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getZone1ClimbingWorkout('recovery');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1ClimbingWorkout('recovery');
        } else if (week === 5) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getClimbingVO2MaxWorkout(5);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1ClimbingWorkout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1ClimbingWorkout('long');
        } else if (week === 6) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1ClimbingWorkout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(6, 'opener');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1ClimbingWorkout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getAlpeDuZwiftTestWorkout();
        }
        
        return workouts;
    }
    
    function generateScientificRacingWeek(week, days) {
        var workouts = {};
        if (!days || days.length === 0) return workouts;
        var dayCount = Math.min(days.length, globalDays);
        
        // Racing specific - MEER Zone 1, minder intensiteit
        if (week === 1) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getRacingVO2MaxWorkout(1);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 2) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getRacingVO2MaxWorkout(2);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 3) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getRacingVO2MaxWorkout(3);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            // Beginners krijgen geen tweede harde sessie in week 3
            if (dayCount >= 4 && days[3]) workouts[days[3]] = globalLevel === 'beginner' ? getZone1Workout('long') : getSprintAnaerobicWorkout(3);
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
            if (dayCount >= 6 && days[5]) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 4) {
            // Recovery with easy race
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getZone1Workout('recovery');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getEasyRaceWorkout();
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('recovery');
        } else if (week === 5) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getRacingVO2MaxWorkout(5);
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5 && days[4]) workouts[days[4]] = getZone1Workout('long');
        } else if (week === 6) {
            if (dayCount >= 1 && days[0]) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2 && days[1]) workouts[days[1]] = getVO2MaxWorkout(6, 'opener');
            if (dayCount >= 3 && days[2]) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4 && days[3]) workouts[days[3]] = getTargetRaceWorkout();
        }
        
        return workouts;
    }
    
    function generateScientificEnduranceWeek(week, days) {
        var workouts = {};
        if (!days || days.length === 0) return workouts;
        var dayCount = Math.min(days.length, globalDays);
        
        // Endurance specific - volume focus with minimal intensity
        if (week <= 3) {
            if (dayCount >= 1) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2) workouts[days[1]] = week % 2 === 1 ? getEnduranceVO2MaxWorkout(week) : getZone1Workout('endurance');
            if (dayCount >= 3) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4) workouts[days[3]] = getZone1Workout('endurance');
            if (dayCount >= 5) workouts[days[4]] = getZone1Workout('very_long');
            if (dayCount >= 6) workouts[days[5]] = getZone1Workout('recovery');
        } else if (week === 4) {
            // Recovery with moderate rides
            for (var i = 0; i < Math.min(dayCount, 4); i++) {
                workouts[days[i]] = getZone1Workout(i % 2 === 0 ? 'endurance' : 'recovery');
            }
        } else {
            // Final prep
            if (dayCount >= 1) workouts[days[0]] = getZone1Workout('endurance');
            if (dayCount >= 2) workouts[days[1]] = week === 5 ? getEnduranceVO2MaxWorkout(week) : getZone1Workout('recovery');
            if (dayCount >= 3) workouts[days[2]] = getZone1Workout('recovery');
            if (dayCount >= 4) workouts[days[3]] = week === 6 ? getGranFondoTestWorkout() : getZone1Workout('race_simulation');
            if (dayCount >= 5) workouts[days[4]] = getZone1Workout('recovery');
        }
        
        return workouts;
    }
    
    // ZONE 1 WORKOUTS with accurate TSS calculations
    function getZone1Workout(type) {
        var zone1Recovery = Math.round(globalFtp * 0.55);
        var zone1Easy = Math.round(globalFtp * 0.62);
        var zone1Endurance = Math.round(globalFtp * 0.68);
        
        var levelMultiplier = globalLevel === 'beginner' ? 0.9 : globalLevel === 'advanced' ? 1.1 : 1.0;
        
        if (type === 'recovery') {
            var duration = Math.round(45 * levelMultiplier);
            return {
                name: 'Zone 1 Actief Herstel',
                description: duration + 'min @ ' + zone1Recovery + '-' + zone1Easy + 'W',
                duration: duration,
                intensity: 'easy',
                emoji: 'üòå',
                zone: 1,
                structure: 'Warming-up: 10min geleidelijk naar ' + zone1Recovery + 'W\nHoofdblok: ' + (duration-20) + 'min steady @ ' + zone1Recovery + 'W\nCooling-down: 10min uitrijden',
                details: ['Netflix perfect!', 'Conversatie mogelijk', '1 ventilator laag', 'Hydratatie: 400ml/uur'],
                tss: Math.round(duration * 0.42 * 0.42 * 100 / 60) // Realistic weighted TSS
            };
        } else if (type === 'endurance') {
            var duration = Math.round(75 * levelMultiplier);
            return {
                name: 'Zone 1 Aerobe Basis',
                description: duration + 'min @ ' + zone1Easy + '-' + zone1Endurance + 'W',
                duration: duration,
                intensity: 'easy',
                emoji: 'üíö',
                zone: 1,
                structure: 'Warming-up: 15min geleidelijk naar ' + zone1Easy + 'W\nHoofdblok: ' + (duration-25) + 'min @ ' + zone1Endurance + 'W\nCooling-down: 10min uitrijden',
                details: ['Zwift group rides perfect', 'Praten mogelijk', 'Aerobe ontwikkeling', '500ml/uur drinken'],
                tss: Math.round(duration * 0.50 * 0.50 * 100 / 60)
            };
        } else if (type === 'long') {
            var duration = Math.round(120 * levelMultiplier);
            return {
                name: 'Zone 1 Lange Duurrit',
                description: duration + 'min @ ' + zone1Endurance + 'W steady',
                duration: duration,
                intensity: 'easy',
                emoji: '‚è∞',
                zone: 1,
                structure: 'Warming-up: 20min naar ' + zone1Endurance + 'W\nHoofdblok: ' + (duration-35) + 'min steady power\nCooling-down: 15min uitrijden',
                details: ['Voeding: 30-60g KH/uur', 'Mentale training', 'Fat adaptation', 'Break elke 45min'],
                tss: Math.round(duration * 0.45 * 0.45 * 100 / 60)
            };
        } else if (type === 'very_long') {
            var duration = Math.round(150 * levelMultiplier);
            return {
                name: 'Zone 1 Ultra Duurrit',
                description: duration + 'min @ ' + zone1Easy + 'W constant',
                duration: duration,
                intensity: 'easy',
                emoji: 'üö¥',
                zone: 1,
                structure: 'Warming-up: 20min\nHoofdblok: ' + (duration-35) + 'min @ ' + zone1Easy + 'W\nCooling-down: 15min',
                details: ['60-90g KH/uur', 'Electrolytes!', 'Position changes', '750ml/uur'],
                tss: Math.round(duration * 0.48 * 0.48 * 100 / 60)
            };
        } else if (type === 'medium') {
            var duration = Math.round(60 * levelMultiplier);
            return {
                name: 'Zone 1 Medium',
                description: duration + 'min @ ' + zone1Easy + 'W relaxed',
                duration: duration,
                intensity: 'easy',
                emoji: 'üå±',
                zone: 1,
                structure: 'Warming-up: 10min\nHoofdblok: ' + (duration-20) + 'min easy\nCooling-down: 10min',
                details: ['Recovery focus', 'Easy spinning', 'Low stress', 'Active rest'],
                tss: Math.round(duration * 0.62 * 0.62 * 100 / 60)
            };
        }
        
        // Default
        return getZone1Workout('endurance');
    }
    
    // THRESHOLD WORKOUTS (limited use, 85-105% FTP)
    function getThresholdWorkout(week, type) {
        var ftp95 = Math.round(globalFtp * 0.95);
        var ftp100 = globalFtp;
        var ftp105 = Math.round(globalFtp * 1.05);
        
        if (type === 'intro') {
            return {
                name: 'Threshold Introductie',
                description: '2√ó12min @ ' + ftp95 + 'W (95% FTP)',
                duration: 75,
                intensity: 'threshold',
                emoji: 'üéØ',
                zone: 'threshold',
                structure: 'Warming-up: 20min met 3√ó2min @ 90% FTP\nInterval 1: 12min @ ' + ftp95 + 'W\nRust: 8min easy\nInterval 2: 12min @ ' + ftp95 + 'W\nCooling-down: 15min',
                details: ['ERG mode aan', 'Steady breathing', 'Focus op vorm', 'Net onder FTP'],
                tss: Math.round(75 * 0.85 * 0.85 * 100 / 60)
            };
        } else if (type === 'build') {
            return {
                name: 'Threshold Opbouw',
                description: '2√ó15min @ ' + ftp100 + 'W (100% FTP)',
                duration: 80,
                intensity: 'threshold',
                emoji: 'üí™',
                zone: 'threshold',
                structure: 'Warming-up: 20min met 3√ó3min @ 90% FTP\nInterval 1: 15min @ ' + ftp100 + 'W\nRust: 10min easy\nInterval 2: 15min @ ' + ftp100 + 'W\nCooling-down: 15min',
                details: ['Exact FTP power', 'Controlled breathing', 'Mental focus', 'Lactate steady state'],
                tss: Math.round(80 * 0.90 * 0.90 * 100 / 60)
            };
        } else if (type === 'peak') {
            return {
                name: 'Threshold Peak',
                description: '1√ó25min @ ' + ftp100 + 'W + 1√ó10min @ ' + ftp105 + 'W',
                duration: 85,
                intensity: 'threshold',
                emoji: 'üî•',
                zone: 'threshold',
                structure: 'Warming-up: 20min progressief\nInterval 1: 25min @ ' + ftp100 + 'W\nRust: 8min\nInterval 2: 10min @ ' + ftp105 + 'W\nCooling-down: 15min',
                details: ['Peak threshold power', 'Progressive overload', 'Mental toughness', 'Fans op max!'],
                tss: Math.round(85 * 0.95 * 0.95 * 100 / 60)
            };
        } else if (type === 'short') {
            return {
                name: 'Threshold Short',
                description: '2√ó8min @ ' + ftp100 + 'W (100% FTP)',
                duration: 60,
                intensity: 'threshold',
                emoji: '‚ö°',
                zone: 'threshold',
                structure: 'Warming-up: 15min\n2√ó (8min @ ' + ftp100 + 'W, 6min recovery)\nCooling-down: 15min',
                details: ['Korte threshold blokken', 'Quick recovery', 'High quality work', 'Maintain power'],
                tss: Math.round(60 * 0.75 * 0.75 * 100 / 60)
            };
        }
        
        return getThresholdWorkout(week, 'build'); // Default
    }
    
    // ZONE 3+ WORKOUTS (>105% FTP)
    function getVO2MaxWorkout(week, type) {
        var vo2watts = Math.round(globalFtp * 1.15);
        var reps = Math.min(3 + week, 8); // Progressive overload
        
        if (globalLevel === 'beginner') {
            vo2watts = Math.round(globalFtp * 1.10);
            reps = Math.max(reps - 1, 3);
        } else if (globalLevel === 'advanced') {
            vo2watts = Math.round(globalFtp * 1.20);
            reps = Math.min(reps + 1, 8);
        }
        
        if (type === 'opener') {
            reps = 3;
            vo2watts = Math.round(globalFtp * 1.10);
        } else if (type === 'sharpener') {
            reps = 5;
            vo2watts = Math.round(globalFtp * 1.18);
        }
        
        var totalDuration = 60 + reps * 8; // Base + intervals + recovery
        
        return {
            name: 'Zone 3 VO‚ÇÇmax Intervals',
            description: reps + '√ó3min @ ' + vo2watts + 'W (115% FTP)',
            duration: totalDuration,
            intensity: 'hard',
            emoji: 'üî•',
            zone: 3,
            structure: 'Warming-up: 20min met 3√ó90sec @ 100% FTP\n' + reps + '√ó (3min @ ' + vo2watts + 'W, 3min recovery)\nCooling-down: 15min',
            details: ['ERG mode aan', 'Maximale aerobe power', 'Controlled breathing', 'Fans op maximum!'],
            tss: Math.round(totalDuration * 0.75 * 0.75 * 100 / 60) // Adjusted for intensity distribution
        };
    }
    
    // Add more specific workout functions...
    function getClimbingVO2MaxWorkout(week) {
        var watts = Math.round(globalFtp * 1.12);
        var reps = Math.min(4 + week, 7);
        
        return {
            name: 'Zone 3 Klim VO‚ÇÇmax',
            description: reps + '√ó4min @ ' + watts + 'W (seated, 60rpm)',
            duration: 75,
            intensity: 'hard',
            emoji: '‚õ∞Ô∏è',
            zone: 3,
            structure: 'Warming-up: 20min\n' + reps + '√ó (4min @ ' + watts + 'W seated, 3min recovery)\nCooling-down: 15min',
            details: ['Seated position only', '60-65rpm target', 'Simulate steep climbs', 'Power-to-weight focus'],
            tss: Math.round(75 * 0.78 * 0.78 * 100 / 60)
        };
    }
    
    function getClimbingThresholdWorkout(week) {
        var watts = Math.round(globalFtp * 0.98);
        
        return {
            name: 'Threshold Klimsimulatie',
            description: '2√ó12min @ ' + watts + 'W climbing position',
            duration: 75,
            intensity: 'threshold',
            emoji: 'üèîÔ∏è',
            zone: 'threshold',
            structure: 'Warming-up: 20min\n2√ó (12min @ ' + watts + 'W, 8min recovery)\nCooling-down: 15min',
            details: ['Climbing position', 'Low cadans 65-75rpm', 'Steady effort', 'Breathing control'],
            tss: Math.round(75 * 0.85 * 0.85 * 100 / 60)
        };
    }
    
    function getZone1ClimbingWorkout(type) {
        var baseWorkout = getZone1Workout(type);
        baseWorkout.name = 'Zone 1 Klim ' + (type === 'recovery' ? 'Herstel' : type === 'long' ? 'Lange Rit' : 'Basis');
        baseWorkout.emoji = 'üèîÔ∏è';
        baseWorkout.details = ['Heuvelachtige routes', 'Climbing position practice', 'Steady power uphills', 'Cadans variatie'];
        return baseWorkout;
    }
    
    // Continue with racing and endurance specific workouts...
    function getRacingVO2MaxWorkout(week) {
        var watts = Math.round(globalFtp * 1.18);
        var reps = Math.min(5 + week, 8);
        
        return {
            name: 'Zone 3 Racing VO‚ÇÇmax',
            description: reps + '√ó3min @ ' + watts + 'W race intensity',
            duration: 75,
            intensity: 'hard',
            emoji: 'üèÅ',
            zone: 3,
            structure: 'Warming-up: 20min race pace\n' + reps + '√ó (3min @ ' + watts + 'W, 2min recovery)\nCooling-down: 15min',
            details: ['Race position', 'High cadans 95-105rpm', 'Attack simulation', 'Competitive mindset'],
            tss: Math.round(75 * 0.80 * 0.80 * 100 / 60)
        };
    }
    
    function getSprintAnaerobicWorkout(week) {
        var watts = Math.round(globalFtp * 1.50);
        var reps = Math.min(6 + week, 10);
        
        return {
            name: 'Zone 3 Sprint Anaeroob',
            description: reps + '√ó15sec @ ' + watts + 'W maximum',
            duration: 60,
            intensity: 'hard',
            emoji: '‚ö°',
            zone: 3,
            structure: 'Warming-up: 20min met 3√ó5sec sprints\n' + reps + '√ó (15sec max, 3min recovery)\nCooling-down: 15min',
            details: ['ERG mode UIT!', 'Maximum power', 'Sprint technique', 'Neuromuscular power'],
            tss: Math.round(60 * 0.65 * 0.65 * 100 / 60)
        };
    }
    
    function getEnduranceVO2MaxWorkout(week) {
        var watts = Math.round(globalFtp * 1.08);
        var reps = Math.min(3 + Math.floor(week/2), 5);
        
        return {
            name: 'Zone 3 Duur VO‚ÇÇmax',
            description: reps + '√ó5min @ ' + watts + 'W sustained',
            duration: 75,
            intensity: 'hard',
            emoji: 'üîã',
            zone: 3,
            structure: 'Warming-up: 20min\n' + reps + '√ó (5min @ ' + watts + 'W, 5min recovery)\nCooling-down: 15min',
            details: ['Longer intervals', 'Sustainable intensity', 'Aerobic power', 'Endurance specific'],
            tss: Math.round(75 * 0.70 * 0.70 * 100 / 60)
        };
    }
    
    // TEST WORKOUTS
    function getFTPTestWorkout() {
        return {
            name: 'FTP Test Protocol',
            description: '20min ALL-OUT test @ maximum sustainable power',
            duration: 75,
            intensity: 'test',
            emoji: 'üèÜ',
            zone: 'threshold',
            structure: 'Warming-up: 20min met 5min @ 90% current FTP\nRest: 10min easy\nTEST: 20min MAXIMUM effort\nCooling-down: 15min\nFTP = 95% van 20min gemiddelde',
            details: ['Mental preparation cruciaal', 'Pacing strategie', 'Fans op maximum', 'Nieuwe FTP = 95% van test'],
            tss: Math.round(75 * 0.95 * 0.95 * 100 / 60)
        };
    }
    
    function getAlpeDuZwiftTestWorkout() {
        var targetWatts = Math.round(globalFtp * 0.85);
        
        return {
            name: 'Alpe du Zwift Test',
            description: 'Klim Alpe @ ' + targetWatts + 'W steady - target <60min',
            duration: 75,
            intensity: 'test',
            emoji: 'üèîÔ∏è',
            zone: 'threshold',
            structure: 'Warming-up: 15min\nAlpe du Zwift: steady @ ' + targetWatts + 'W\nCooling-down: 10min',
            details: ['Target: sub-60 minuten', 'Steady pacing crucial', 'Test W/kg performance', 'Climbing endurance'],
            tss: Math.round(75 * 0.80 * 0.80 * 100 / 60)
        };
    }
    
    function getTargetRaceWorkout() {
        return {
            name: 'Target Race Performance',
            description: 'Je doel race - apply all training!',
            duration: 60,
            intensity: 'race',
            emoji: 'üèÜ',
            zone: 3,
            structure: 'Warming-up: 20min race prep\nRACE: Apply training\nCooling-down: 10min celebration',
            details: ['Execute race plan', 'Use all trained systems', 'Peak performance', 'Trust your training!'],
            tss: Math.round(60 * 0.90 * 0.90 * 100 / 60)
        };
    }
    
    function getGranFondoTestWorkout() {
        var targetWatts = Math.round(globalFtp * 0.68);
        
        return {
            name: 'Gran Fondo Test',
            description: '3u @ ' + targetWatts + 'W - endurance test',
            duration: 180,
            intensity: 'test',
            emoji: 'üèÖ',
            zone: 1,
            structure: 'Warming-up: 20min\nTest: 2u40min @ ' + targetWatts + 'W\nCooling-down: 20min',
            details: ['Nutrition strategy test', 'Pacing discipline', 'Mental endurance', 'Aerobic efficiency'],
            tss: Math.round(180 * 0.68 * 0.68 * 100 / 60)
        };
    }
    
    function getEasyRaceWorkout() {
        return {
            name: 'Easy Group Race',
            description: 'Join C/D kategorie race - recovery intensity',
            duration: 45,
            intensity: 'easy',
            emoji: 'üéÆ',
            zone: 1,
            structure: 'Join Zwift C or D race\nStay in Zone 1\nFocus: tactics, fun\nNo full efforts',
            details: ['Recovery race intensity', 'Practice positioning', 'Social riding', 'No stress, just fun'],
            tss: Math.round(45 * 0.65 * 0.65 * 100 / 60)
        };
    }
    
    function createWorkoutCard(day, workout) {
        var html = '<div class="vv-workout">';
        html += '<div class="vv-workout-header">';
        html += '<div>';
        html += '<span class="vv-workout-emoji">' + workout.emoji + '</span>';
        html += '<span class="vv-workout-day">' + day + '</span>';
        html += '</div>';
        
        html += '<div class="vv-workout-tags">';
        if (workout.duration > 0) {
            html += '<span class="vv-workout-duration">' + workout.duration + ' min</span>';
        }
        if (workout.zone === 1) {
            html += '<span class="vv-zone-tag">Zone 1</span>';
        } else if (workout.zone === 3) {
            html += '<span class="vv-zone-tag zone3">Zone 3</span>';
        } else if (workout.zone === 'threshold') {
            html += '<span class="vv-zone-tag threshold">Threshold</span>';
        }
        if (workout.tss) {
            html += '<span class="vv-tss-tag">' + workout.tss + ' TSS</span>';
        }
        if (globalTrainer === 'smart' && (workout.intensity === 'hard' || workout.intensity === 'threshold')) {
            html += '<span class="vv-erg-mode">ERG</span>';
        }
        html += '</div>';
        
        html += '</div>';
        
        html += '<div class="vv-workout-description">' + workout.name + '</div>';
        html += '<p style="margin: 10px 0; font-size: 1rem; font-weight: 500;">' + workout.description + '</p>';
        
        if (workout.structure) {
            html += '<div class="vv-workout-structure">';
            html += '<h5>üìã Workout Structuur</h5>';
            html += '<pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">' + workout.structure + '</pre>';
            html += '</div>';
        }
        
        if (workout.details && workout.details.length > 0) {
            html += '<div class="vv-workout-details">';
            html += '<ul>';
            workout.details.forEach(function(detail) {
                html += '<li>‚Ä¢ ' + detail + '</li>';
            });
            html += '</ul>';
            html += '</div>';
        }
        
        html += '</div>';
        return html;
    }
    
    function createRestDay(day) {
        var html = '<div class="vv-workout vv-rest-day">';
        html += '<div class="vv-workout-header">';
        html += '<div>';
        html += '<span class="vv-workout-emoji">üò¥</span>';
        html += '<span class="vv-workout-day">' + day + '</span>';
        html += '</div>';
        html += '</div>';
        html += '<div class="vv-workout-description">Volledige Rustdag</div>';
        html += '<p>Geen training - focus op herstel, stretching, yoga of massage</p>';
        html += '</div>';
        return html;
    }
    
    function getTrainingDays() {
        var trainingDays = [];
        
        if (globalDays === 3) {
            trainingDays = ['Dinsdag', 'Donderdag', 'Zondag'];
        } else if (globalDays === 4) {
            trainingDays = ['Dinsdag', 'Woensdag', 'Vrijdag', 'Zondag'];
        } else if (globalDays === 5) {
            trainingDays = ['Maandag', 'Woensdag', 'Donderdag', 'Zaterdag', 'Zondag'];
        } else if (globalDays === 6) {
            trainingDays = ['Maandag', 'Dinsdag', 'Woensdag', 'Vrijdag', 'Zaterdag', 'Zondag'];
        }
        
        return trainingDays;
    }
    
    // Export functions
    function exportZwift() {
        // Create structured workout data for potential Zwift export
        var workoutData = {
            user: {
                ftp: globalFtp,
                weight: globalWeight,
                goal: globalGoal,
                level: globalLevel
            },
            weeks: []
        };
        
        // In future version, this would generate .zwo files
        alert('üöß Zwift Export Feature Komt Binnenkort!\n\n' +
              'We werken aan automatische .zwo workout export.\n\n' +
              'Voor nu:\n' +
              '1. Screenshot de workouts\n' +
              '2. Bouw na in Zwift Workout Builder\n' +
              '3. Of join Vivelevelo group events!');
    }
    
    function shareStrava() {
        var text = 'Check mijn wetenschappelijk gepolariseerde trainingsschema! üö¥\n\n' +
                   'üìä FTP: ' + globalFtp + 'W (' + (globalFtp/globalWeight).toFixed(1) + ' W/kg)\n' +
                   'üéØ Doel: ' + globalGoal + '\n' +
                   '‚öñÔ∏è 80% Zone 1 + 20% Zone 3 = ECHT gepolariseerd!\n' +
                   'üî¨ Gebaseerd op Seiler/Coggan onderzoek\n\n' +
                   '#vivelevelo #zwift #gepolariseerd #80-20training #wielrennen #science';
        
        var url = 'https://www.strava.com/posts/new?text=' + encodeURIComponent(text);
        window.open(url, '_blank');
    }
    
    function printPlan() {
        window.print();
    }
    
    function emailPlan() {
        var subject = 'Mijn Wetenschappelijke Gepolariseerde Training Schema';
        var body = 'Bekijk mijn persoonlijke gepolariseerde trainingsschema:\n\n' +
                   'FTP: ' + globalFtp + 'W (' + (globalFtp/globalWeight).toFixed(1) + ' W/kg)\n' +
                   'Doel: ' + globalGoal + '\n' +
                   'Frequentie: ' + globalDays + 'x per week\n\n' +
                   'Link: ' + window.location.href + '\n\n' +
                   'Wetenschappelijk onderbouwd door Vivelevelo.nl';
        
        window.location.href = 'mailto:?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);
    }
    
    function resetVVForm() {
        document.getElementById('vvInputForm').style.display = 'block';
        document.getElementById('vvResults').classList.add('hidden');
        document.querySelector('.vv-progress-fill').style.width = '0%';
        
        // Reset form
        document.getElementById('vvFtp').value = '250';
        document.getElementById('vvWeight').value = '75';
        document.getElementById('vvDays').value = '4';
        document.getElementById('vvGoal').value = 'ftp';
        document.getElementById('vvTrainer').value = 'smart';
        document.getElementById('vvLevel').value = 'intermediate';
        
        // Clear validation messages
        document.querySelectorAll('.error-msg, .success-msg').forEach(function(el) {
            el.textContent = '';
        });
        document.querySelectorAll('.vv-form-group').forEach(function(el) {
            el.classList.remove('error');
        });
        document.querySelectorAll('input').forEach(function(el) {
            el.classList.remove('error');
        });
        
        // Clear session data
        sessionData = {};
        
        updateFormValidation();
        window.scrollTo(0, 0);
    }
    
    // Initialize validation on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadSessionData(); // Load saved data first
        validateInput('all');
        updateProgress();
    });
    </script>
</body>
</html>
